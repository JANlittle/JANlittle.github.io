<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>JANlittle's Blog</title><meta name="author" content="JANlittle"><meta name="copyright" content="JANlittle"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="JANlittle的随笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="JANlittle&#39;s Blog">
<meta property="og:url" content="https://janlittle.github.io/index.html">
<meta property="og:site_name" content="JANlittle&#39;s Blog">
<meta property="og:description" content="JANlittle的随笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://janlittle.github.io/images/misc/avatar.jpg">
<meta property="article:author" content="JANlittle">
<meta property="article:tag" content="Reverse Engineering">
<meta property="article:tag" content="Decompiler">
<meta property="article:tag" content="Deobfuscate">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://janlittle.github.io/images/misc/avatar.jpg"><link rel="shortcut icon" href="/images/misc/avatar.jpg"><link rel="canonical" href="https://janlittle.github.io/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JANlittle\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-08-24 17:49:52'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/misc/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/images/misc/top_img.png')"><nav id="nav"><span id="blog-info"><a href="/" title="JANlittle's Blog"><span class="site-name">JANlittle's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">JANlittle's Blog</h1></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2024/08/24/%E3%80%90%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91SAILR/" title="【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation"><img class="post-bg" src="/images/misc/default_cover5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/08/24/%E3%80%90%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91SAILR/" title="【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation">【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-08-24T09:41:56.000Z" title="发表于 2024-08-24 17:41:56">2024-08-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Decompiler/">Decompiler</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CFG-structuring/">CFG structuring</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/angr/">angr</a></span></div><div class="content">概要
这是目前已知的第一篇探究编译优化是如何具体影响反编译器控制流结构化并试图逆转这种优化的论文。
ASU（shellphish）的研究团队认为，反编译器的结果质量衡量最重要的不是降低复杂度或者消除goto，是尽可能接近原始源代码。而**产生不可控制流结构化的控制流图的根本原因，就是编译器优化以及反编译器和编译器之间的知识差距。**为此，反编译器必须是“编译器感知”的，能够知道当前没能正确匹配的控制流子图是由哪些编译优化引起的，又该如何“反优化”。
为了验证这一目标，作者探究了具体的编译优化选项会导致怎样的异常控制流图，同时在angr的反编译器上开发了第一个“编译器感知”的控制流结构化算法：SAILR。并且经过测试，发现SAILR的CFGED等指标可以与IDA Pro相接近，并且领先于先前的研究成果，如DREAM、revng等。
介绍
在恢复C控制流结构时，原始的控制流结构会被编译器优化所扭曲和破坏。这在反编译器的输出上表现为虚假的goto语句。
文中认为，产生不可结构化代码的根本原因是：编译器优化以及反编译器与编译器的知识差距。
反编译器常常使用图模式匹配来结构化控制流子图，但由于编 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/07/26/angr-ctf%E7%AC%94%E8%AE%B0/" title="angr_ctf笔记"><img class="post-bg" src="/images/misc/default_cover7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="angr_ctf笔记"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/26/angr-ctf%E7%AC%94%E8%AE%B0/" title="angr_ctf笔记">angr_ctf笔记</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-26T14:33:59.000Z" title="发表于 2024-07-26 22:33:59">2024-07-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/reversing/">reversing</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/angr/">angr</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C/">符号执行</a></span></div><div class="content">抽空系统学下angr关于符号执行的一些api。通过angr_ctf来学，可以自己构建，不过solution目录下有已经构建好的程序、练习文件和参考答案，直接用就行了。目录下的SymbolicExecution.pptx还详细讲了一些符号执行的入门知识，可以看看。
00_angr_find
解常规逆向的基本框架，输入来自stdin。同时如果想默认从main函数开始执行，使用entry_state作为初始状态。
12345678910111213141516171819202122232425262728293031import angrimport sysdef main(argv):  path_to_binary = &#x27;./00_angr_find&#x27;  # 起project，需要视情况加参数  project = angr.Project(path_to_binary)  # 起始状态，entry_state表示main()  initial_state = project.factory.entry_state(    add_options = &#123;  ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/07/19/%E5%A6%82%E4%BD%95%E4%B8%BA%E7%8E%B0%E6%9C%89%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8%E6%9E%84%E5%BB%BARust%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%AD%BE%E5%90%8D%E6%96%87%E4%BB%B6%EF%BC%9F/" title="如何为现有反编译器构建stripped Rust binary所需要的签名文件？"><img class="post-bg" src="/images/misc/default_cover7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何为现有反编译器构建stripped Rust binary所需要的签名文件？"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/19/%E5%A6%82%E4%BD%95%E4%B8%BA%E7%8E%B0%E6%9C%89%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8%E6%9E%84%E5%BB%BARust%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%AD%BE%E5%90%8D%E6%96%87%E4%BB%B6%EF%BC%9F/" title="如何为现有反编译器构建stripped Rust binary所需要的签名文件？">如何为现有反编译器构建stripped Rust binary所需要的签名文件？</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-19T09:43:57.000Z" title="发表于 2024-07-19 17:43:57">2024-07-19</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/reversing/">reversing</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Rust/">Rust</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E6%81%A2%E5%A4%8D/">函数签名恢复</a></span></div><div class="content">不知道从什么时候开始，有些老b登构建Rust程序时会把符号strip掉（尤其是在恶意软件和CTF中），大幅度降低了逆向体验😅。如果能恢复符号，哪怕是std库的那些函数符号的话，可读性都会提高很多。
恢复符号的话，一个方法是函数相似性匹配，往小了看有bindiff，往大了看有BinaryAI或者其它一些大数据AI，但前者你需要构建一个合适的程序进行diff，并且选择什么范围的similarity和confidence也是个比较玄学的问题；后者的话目前并没有什么大型的在线大数据匹配有存储大量的rust函数语料。
除此之外，另一个方法就是依靠像IDA和BN这样的反编译器为rust程序所用到的库做签名文件，例如FLIRT和sigkit。它们有着相似的思路：匹配函数硬编码字节与调用图等。其实这就有点像它自动化地做了bindiff的一些事情并顺便帮你做匹配了。这个方法最大的优势就是方便！
对于本地进行符号恢复，无论是bindiff还是为特定反编译器构造签名文件，最重要的当然还是正确构造程序使用的库以进行匹配了。但就像匹配C库的函数你需要考虑编译器版本和库版本等因素一样，在rust中你同样需要考虑 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/07/06/%E3%80%90%E5%8D%9A%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91Binary-Ninja-4-1-Decompiler-Design/" title="【博文笔记】Restructuring the Binary Ninja Decompiler"><img class="post-bg" src="/images/misc/default_cover2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【博文笔记】Restructuring the Binary Ninja Decompiler"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/06/%E3%80%90%E5%8D%9A%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91Binary-Ninja-4-1-Decompiler-Design/" title="【博文笔记】Restructuring the Binary Ninja Decompiler">【博文笔记】Restructuring the Binary Ninja Decompiler</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-06T14:07:33.000Z" title="发表于 2024-07-06 22:07:33">2024-07-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Decompiler/">Decompiler</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Binary-Ninja/">Binary Ninja</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/CFG-structuring/">CFG structuring</a></span></div><div class="content">原博客文章链接：https://binary.ninja/2024/06/19/restructuring-the-decompiler.html
概述
Binary Ninja在4.1版本重构了反编译器，主要集中在其控制流结构化的策略上。这篇博文简单介绍了设计变化，同时这也是一篇挺好的介绍反编译器的主流控制流结构化策略的文章，值得记录一下。
所谓控制流结构化，就是识别控制流图模式，并将其转化/折叠为高级表示，例如C语言中的if...else...语句。
一般来说，在没有优化的情况下识别经典的C语言控制流语句生成的控制流图是非常容易的。但是在编译优化的影响下，函数控制流图的节点和边会被添加/删除/合并等，导致无法与经典控制流图模式相匹配。反编译器在面对控制流结构化时，最主要的挑战就是当控制流子图无法与现有模式匹配时，怎么做才能最大程度提高反编译结果的可读性和准确性？
主流的几个策略
遇事不决添加goto
这个策略算是所有反编译器都会采用的手段，主打一个无脑。**当控制流图无法与已知模式匹配时，反编译器会为节点添加goto语句，并删除其出边来简化图结构，从而与已知模式相匹配。**当然，编 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/07/05/Rust-OLLVM%E5%B9%B3%E5%9D%A6%E5%8C%96%E7%9A%84%E9%82%AA%E6%81%B6%E7%BB%84%E5%90%88/" title="Rust+OLLVM平坦化的邪恶组合"><img class="post-bg" src="/images/misc/default_cover4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rust+OLLVM平坦化的邪恶组合"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/05/Rust-OLLVM%E5%B9%B3%E5%9D%A6%E5%8C%96%E7%9A%84%E9%82%AA%E6%81%B6%E7%BB%84%E5%90%88/" title="Rust+OLLVM平坦化的邪恶组合">Rust+OLLVM平坦化的邪恶组合</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-05T15:05:58.000Z" title="发表于 2024-07-05 23:05:58">2024-07-05</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Deobfuscate/">Deobfuscate</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Rust/">Rust</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/">控制流平坦化</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C/">模拟执行</a></span></div><div class="content">前前前一阵子打了Codegate CTF 2024 Preliminary，有个逆向题(prism_messenger)是Rust+OLLVM平坦化，真的是天才组合啊😅！恶心到我了，同时直接把D810给干崩溃了，qiling的模拟执行也不好使了，事后不得不多瞅了它几眼。
特点
看起来这个Rust程序像是通过源代码级别的宏展开生成的平坦化代码，它有很多跟一般平坦化程序不一样的特点，大部分特点很像是先平坦化后再被编译器优化所得到的结果。以去平坦化的三个步骤来考察：
识别不同块的功能
在这里也就是说识别一个块是分配块、预分配块、虚假块、还是真实块的问题。
首先预分配块可以说是不存在的，或者说跟分配块所合并了，因为大部分真实块到最后会直接跳转到分配块，而不会经过预分配块的中转。也就是说，分配块的前继都是各个真实块，已经没有统一的预分配块了。
其次，真实块也不再是单独一块，而是被分割成好几个子块，有些子块被多次引用，很像是编译优化压缩函数大小导致的。这就为识别谁是真实块带来了很大的挑战。

识别真实块的后继块
真实块中的条件分支可能不再单纯只是根据条件不同修改状态变量实现真实块之间的条件跳转， ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/07/05/%E4%BD%BF%E7%94%A8qiling%E5%87%BB%E8%B4%A5Pluto-Obfuscator%E7%9A%84%E5%A2%9E%E5%BC%BA%E7%89%88%E5%B9%B3%E5%9D%A6%E5%8C%96/" title="使用qiling击败Pluto-Obfuscator的增强版平坦化"><img class="post-bg" src="/images/misc/default_cover4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用qiling击败Pluto-Obfuscator的增强版平坦化"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/05/%E4%BD%BF%E7%94%A8qiling%E5%87%BB%E8%B4%A5Pluto-Obfuscator%E7%9A%84%E5%A2%9E%E5%BC%BA%E7%89%88%E5%B9%B3%E5%9D%A6%E5%8C%96/" title="使用qiling击败Pluto-Obfuscator的增强版平坦化">使用qiling击败Pluto-Obfuscator的增强版平坦化</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-04T16:50:14.000Z" title="发表于 2024-07-05 00:50:14">2024-07-05</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Deobfuscate/">Deobfuscate</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/">控制流平坦化</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C/">模拟执行</a></span></div><div class="content">好久前弄的，补个档。
概述
R1mao👴在2022年为Pluto-Obfuscator加了个新的控制流平坦化算法，旨在对抗一般的静态/动态去混淆脚本。然而他的算法可以被”动态模拟执行+BFS探索真实块“所破解。
不过这个去混淆算法没什么实用价值，因为Pluto-Obfuscator已经长时间无人维护了，R1mao👴的这个算法也没人用力，顶多就CTF偶尔有人炒冷饭吧，破它就当图个乐。
修改后的qiling脚本可以在这里找到：https://github.com/JANlittle/qiling/tree/dev
R1mao👴的算法干了啥？
一般的OLLVM平坦化中的真实块会对状态变量直接赋新值来确定它的后继。那么一般的静态对抗手法就是定位真实块对状态变量的赋值，并查找这个状态变量对应的真实块，从而确定真实块后继；一般的动态对抗手法就是遍历并模拟执行每个真实块，探索它的后继块。
R1mao👴的算法改进如下：

每个真实块都会被分配一个key变量和访问标志位。
每个真实块第一次被访问时，都会修改其后继所有块（包括后继的后继的后继…）的key变量。
只有以正确顺序访问真实块，才能依次正 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/07/04/Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Rust学习笔记"><img class="post-bg" src="/images/misc/default_cover7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rust学习笔记"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/04/Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Rust学习笔记">Rust学习笔记</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-03T16:30:38.000Z" title="发表于 2024-07-04 00:30:38">2024-07-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%9D%82%E4%B9%B1%E7%AC%94%E8%AE%B0/">杂乱笔记</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Rust/">Rust</a></span></div><div class="content">变量
基本


不可变、可变、常量：
  123let a = 0;	// 不可变变量，但可以shadowinglet mut a = 0;	// 可变变量const A: i32 = 0;	// 常量，必须手动标注类型


变量解构
  12345678910111213141516let (a, mut b): (bool,bool) = (true, false);struct Struct &#123;    e: i32&#125;fn main() &#123;    let (a, b, c, d, e);    (a, b) = (1, 2);    // _ 代表匹配一个值，但是我们不关心具体的值是什么，因此没有使用一个变量名而是使用了 _    [c, .., d, _] = [1, 2, 3, 4, 5];    Struct &#123; e, .. &#125; = Struct &#123; e: 5 &#125;;    assert_eq!([1, 2, 1, 4, 5], [a, b, c, d, e]);&#125;


整数类型
u8~u128，i ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/07/03/hello-world/" title="hexo简易使用"><img class="post-bg" src="/images/misc/default_cover2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo简易使用"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/07/03/hello-world/" title="hexo简易使用">hexo简易使用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-07-03T02:48:27.297Z" title="发表于 2024-07-03 10:48:27">2024-07-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%9D%82%E4%B9%B1%E7%AC%94%E8%AE%B0/">杂乱笔记</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/hexo/">hexo</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
也可以看傻瓜教程。
Quick Start
Create a new post
1$ hexo new &quot;My New Post&quot;
More info: Writing
Run server
启动本地服务器，用于在部署前查看效果
1$ hexo server
More info: Server
Generate static files
1$ hexo generate
More info: Generating
Deploy to remote sites
123$ hexo deploy# 一键生成静态文件+部署$ hexo g -d
More info: Deployment
 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/misc/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JANlittle</div><div class="author-info__description">JANlittle的随笔记</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/JANlittle"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/24/%E3%80%90%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91SAILR/" title="【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation"><img src="/images/misc/default_cover5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation"/></a><div class="content"><a class="title" href="/2024/08/24/%E3%80%90%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91SAILR/" title="【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation">【论文笔记】Ahoy SAILR! There is No Need to DREAM of C A Compiler-Aware Structuring Algorithm for Binary Decompilation</a><time datetime="2024-08-24T09:41:56.000Z" title="发表于 2024-08-24 17:41:56">2024-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/26/angr-ctf%E7%AC%94%E8%AE%B0/" title="angr_ctf笔记"><img src="/images/misc/default_cover7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="angr_ctf笔记"/></a><div class="content"><a class="title" href="/2024/07/26/angr-ctf%E7%AC%94%E8%AE%B0/" title="angr_ctf笔记">angr_ctf笔记</a><time datetime="2024-07-26T14:33:59.000Z" title="发表于 2024-07-26 22:33:59">2024-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/19/%E5%A6%82%E4%BD%95%E4%B8%BA%E7%8E%B0%E6%9C%89%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8%E6%9E%84%E5%BB%BARust%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%AD%BE%E5%90%8D%E6%96%87%E4%BB%B6%EF%BC%9F/" title="如何为现有反编译器构建stripped Rust binary所需要的签名文件？"><img src="/images/misc/default_cover7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何为现有反编译器构建stripped Rust binary所需要的签名文件？"/></a><div class="content"><a class="title" href="/2024/07/19/%E5%A6%82%E4%BD%95%E4%B8%BA%E7%8E%B0%E6%9C%89%E5%8F%8D%E7%BC%96%E8%AF%91%E5%99%A8%E6%9E%84%E5%BB%BARust%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%AD%BE%E5%90%8D%E6%96%87%E4%BB%B6%EF%BC%9F/" title="如何为现有反编译器构建stripped Rust binary所需要的签名文件？">如何为现有反编译器构建stripped Rust binary所需要的签名文件？</a><time datetime="2024-07-19T09:43:57.000Z" title="发表于 2024-07-19 17:43:57">2024-07-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/06/%E3%80%90%E5%8D%9A%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91Binary-Ninja-4-1-Decompiler-Design/" title="【博文笔记】Restructuring the Binary Ninja Decompiler"><img src="/images/misc/default_cover2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【博文笔记】Restructuring the Binary Ninja Decompiler"/></a><div class="content"><a class="title" href="/2024/07/06/%E3%80%90%E5%8D%9A%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%91Binary-Ninja-4-1-Decompiler-Design/" title="【博文笔记】Restructuring the Binary Ninja Decompiler">【博文笔记】Restructuring the Binary Ninja Decompiler</a><time datetime="2024-07-06T14:07:33.000Z" title="发表于 2024-07-06 22:07:33">2024-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/05/Rust-OLLVM%E5%B9%B3%E5%9D%A6%E5%8C%96%E7%9A%84%E9%82%AA%E6%81%B6%E7%BB%84%E5%90%88/" title="Rust+OLLVM平坦化的邪恶组合"><img src="/images/misc/default_cover4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rust+OLLVM平坦化的邪恶组合"/></a><div class="content"><a class="title" href="/2024/07/05/Rust-OLLVM%E5%B9%B3%E5%9D%A6%E5%8C%96%E7%9A%84%E9%82%AA%E6%81%B6%E7%BB%84%E5%90%88/" title="Rust+OLLVM平坦化的邪恶组合">Rust+OLLVM平坦化的邪恶组合</a><time datetime="2024-07-05T15:05:58.000Z" title="发表于 2024-07-05 23:05:58">2024-07-05</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Decompiler/"><span class="card-category-list-name">Decompiler</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Deobfuscate/"><span class="card-category-list-name">Deobfuscate</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/reversing/"><span class="card-category-list-name">reversing</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%9D%82%E4%B9%B1%E7%AC%94%E8%AE%B0/"><span class="card-category-list-name">杂乱笔记</span><span class="card-category-list-count">2</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C/" style="font-size: 1.1em; color: #999">符号执行</a> <a href="/tags/Rust/" style="font-size: 1.5em; color: #99a9bf">Rust</a> <a href="/tags/CFG-structuring/" style="font-size: 1.3em; color: #99a1ac">CFG structuring</a> <a href="/tags/%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%E6%81%A2%E5%A4%8D/" style="font-size: 1.1em; color: #999">函数签名恢复</a> <a href="/tags/%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/" style="font-size: 1.3em; color: #99a1ac">控制流平坦化</a> <a href="/tags/Binary-Ninja/" style="font-size: 1.1em; color: #999">Binary Ninja</a> <a href="/tags/angr/" style="font-size: 1.3em; color: #99a1ac">angr</a> <a href="/tags/%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C/" style="font-size: 1.3em; color: #99a1ac">模拟执行</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 1.1em; color: #999">教程</a> <a href="/tags/hexo/" style="font-size: 1.1em; color: #999">hexo</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><span class="card-archive-list-count">7</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">8</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-08-24T09:49:52.247Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By JANlittle</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>